<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Bexio ‚Üí Power BI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Sidebar Menu -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>üìä Bexio Dashboard</h2>
            <p class="version">v1.0</p>
        </div>

        <ul class="menu">
            <li class="menu-item active" data-page="dashboard">
                <span class="icon">üè†</span>
                <span class="label">Dashboard</span>
            </li>
            <li class="menu-item" data-page="sync">
                <span class="icon">üîÑ</span>
                <span class="label">Synchronisation</span>
            </li>
            <li class="menu-item" data-page="history">
                <span class="icon">üìÅ</span>
                <span class="label">Historique</span>
            </li>
            <li class="menu-item" data-page="stats">
                <span class="icon">üìä</span>
                <span class="label">Statistiques</span>
            </li>
            <li class="menu-item" data-page="config">
                <span class="icon">‚öôÔ∏è</span>
                <span class="label">Configuration</span>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="status-badge" id="apiStatus">
                <span class="status-dot"></span>
                <span class="status-text">Non configur√©</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page: Dashboard -->
        <div class="page active" id="page-dashboard">
            <div class="page-header">
                <h1>Dashboard</h1>
                <p class="subtitle">Bienvenue dans votre tableau de bord Bexio ‚Üí Power BI</p>
            </div>

            <div class="cards-grid">
                <div class="info-card">
                    <div class="card-icon">üéØ</div>
                    <h3>Qu'est-ce que c'est ?</h3>
                    <p>Une application qui synchronise automatiquement vos donn√©es Bexio (contacts, factures, projets) vers des fichiers Excel compatibles Power BI.</p>
                </div>

                <div class="info-card">
                    <div class="card-icon">‚ö°</div>
                    <h3>Rapide et Simple</h3>
                    <p>En un clic, extrayez toutes vos donn√©es Bexio et t√©l√©chargez-les au format Excel pr√™t pour Power BI Desktop.</p>
                </div>

                <div class="info-card">
                    <div class="card-icon">üîí</div>
                    <h3>100% S√©curis√©</h3>
                    <p>Vos donn√©es restent priv√©es. La cl√© API est stock√©e en m√©moire uniquement. Aucune donn√©e n'est envoy√©e ailleurs.</p>
                </div>
            </div>

            <div class="quick-actions">
                <h2>Actions Rapides</h2>
                <div class="action-buttons">
                    <button class="action-btn" onclick="navigateTo('config')">
                        <span class="btn-icon">‚öôÔ∏è</span>
                        <span class="btn-text">Configurer l'API Bexio</span>
                    </button>
                    <button class="action-btn" onclick="navigateTo('sync')" id="quickSyncBtn" disabled>
                        <span class="btn-icon">üîÑ</span>
                        <span class="btn-text">Synchroniser maintenant</span>
                    </button>
                    <button class="action-btn" onclick="navigateTo('history')">
                        <span class="btn-icon">üìÅ</span>
                        <span class="btn-text">Voir l'historique</span>
                    </button>
                </div>
            </div>

            <div class="stats-overview" id="dashboardStats">
                <h2>Aper√ßu Rapide</h2>
                <div class="stats-row">
                    <div class="stat-box">
                        <div class="stat-value" id="totalContacts">-</div>
                        <div class="stat-label">Contacts</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalInvoices">-</div>
                        <div class="stat-label">Factures</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalProjects">-</div>
                        <div class="stat-label">Projets</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalRevenue">-</div>
                        <div class="stat-label">Chiffre d'affaires</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Synchronisation -->
        <div class="page" id="page-sync">
            <div class="page-header">
                <h1>Synchronisation</h1>
                <p class="subtitle">Extraire les donn√©es de Bexio</p>
            </div>

            <div class="sync-container">
                <div class="sync-card">
                    <h2>Synchroniser les donn√©es Bexio</h2>
                    <p>Cette op√©ration va extraire toutes vos donn√©es Bexio (contacts, factures, projets) et les exporter vers un fichier Excel.</p>

                    <div class="progress-section" id="progressSection" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-info">
                            <span id="progressPercent">0%</span>
                            <span id="progressMessage">En attente...</span>
                        </div>
                    </div>

                    <div class="sync-stats">
                        <div class="sync-stat-item">
                            <span class="stat-icon">üë•</span>
                            <span class="stat-number" id="syncContacts">0</span>
                            <span class="stat-name">Contacts</span>
                        </div>
                        <div class="sync-stat-item">
                            <span class="stat-icon">üìÑ</span>
                            <span class="stat-number" id="syncInvoices">0</span>
                            <span class="stat-name">Factures</span>
                        </div>
                        <div class="sync-stat-item">
                            <span class="stat-icon">üìÅ</span>
                            <span class="stat-number" id="syncProjects">0</span>
                            <span class="stat-name">Projets</span>
                        </div>
                        <div class="sync-stat-item">
                            <span class="stat-icon">üí∞</span>
                            <span class="stat-number" id="syncRevenue">CHF 0</span>
                            <span class="stat-name">CA Total</span>
                        </div>
                    </div>

                    <div class="sync-actions">
                        <button class="btn btn-primary btn-large" id="syncBtn" onclick="startSync()">
                            <span>üîÑ</span> Lancer la synchronisation
                        </button>
                        <button class="btn btn-secondary" id="downloadBtn" onclick="downloadFile()" style="display: none;">
                            <span>üì•</span> T√©l√©charger le fichier Excel
                        </button>
                    </div>

                    <div class="last-sync-info" id="lastSyncInfo" style="display: none;">
                        <p>Derni√®re synchronisation : <strong id="lastSyncTime">Jamais</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Historique -->
        <div class="page" id="page-history">
            <div class="page-header">
                <h1>Historique</h1>
                <p class="subtitle">Fichiers export√©s pr√©c√©demment</p>
            </div>

            <div class="history-container">
                <div class="history-list" id="historyList">
                    <div class="empty-state">
                        <div class="empty-icon">üìÇ</div>
                        <h3>Aucun fichier export√©</h3>
                        <p>Lancez une synchronisation pour voir l'historique de vos exports.</p>
                        <button class="btn btn-primary" onclick="navigateTo('sync')">
                            Synchroniser maintenant
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Statistiques -->
        <div class="page" id="page-stats">
            <div class="page-header">
                <h1>Statistiques</h1>
                <p class="subtitle">Analyses de vos donn√©es Bexio</p>
            </div>

            <div class="stats-container">
                <div class="stats-grid-large">
                    <div class="stat-card-large">
                        <h3>Contacts</h3>
                        <div class="stat-value-large" id="statsContacts">0</div>
                        <p class="stat-description">Total des contacts dans Bexio</p>
                    </div>

                    <div class="stat-card-large">
                        <h3>Factures</h3>
                        <div class="stat-value-large" id="statsInvoices">0</div>
                        <p class="stat-description">Total des factures √©mises</p>
                    </div>

                    <div class="stat-card-large">
                        <h3>Projets</h3>
                        <div class="stat-value-large" id="statsProjects">0</div>
                        <p class="stat-description">Projets actifs et termin√©s</p>
                    </div>

                    <div class="stat-card-large highlight">
                        <h3>Chiffre d'affaires</h3>
                        <div class="stat-value-large" id="statsRevenue">CHF 0</div>
                        <p class="stat-description">Montant total des factures</p>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üí° Note :</strong> Ces statistiques sont bas√©es sur la derni√®re synchronisation.
                    Lancez une nouvelle synchronisation pour obtenir les donn√©es √† jour.
                </div>
            </div>
        </div>

        <!-- Page: Configuration -->
        <div class="page" id="page-config">
            <div class="page-header">
                <h1>Configuration</h1>
                <p class="subtitle">Param√®tres de l'application</p>
            </div>

            <div class="config-container">
                <div class="config-card">
                    <h2>Connexion √† l'API Bexio</h2>
                    <p>Entrez votre cl√© API Bexio pour permettre l'extraction des donn√©es.</p>

                    <div class="form-group">
                        <label for="apiKey">Cl√© API Bexio</label>
                        <input
                            type="password"
                            id="apiKey"
                            class="input-field"
                            placeholder="Entrez votre cl√© API..."
                        >
                        <small class="help-text">
                            Obtenez votre cl√© API sur
                            <a href="https://office.bexio.com/index.php/settings/api" target="_blank">
                                Bexio ‚Üí Param√®tres ‚Üí API
                            </a>
                        </small>
                    </div>

                    <button class="btn btn-primary" onclick="saveConfig()">
                        üíæ Enregistrer la configuration
                    </button>

                    <div class="config-status" id="configStatus" style="display: none;">
                        <div class="status-icon">‚úÖ</div>
                        <div class="status-message">
                            <strong>Configuration enregistr√©e</strong>
                            <p>Votre cl√© API est valide et fonctionnelle.</p>
                        </div>
                    </div>
                </div>

                <div class="config-card">
                    <h2>√Ä propos</h2>
                    <div class="about-info">
                        <p><strong>Application :</strong> Dashboard Bexio ‚Üí Power BI</p>
                        <p><strong>Version :</strong> 1.0.0</p>
                        <p><strong>D√©velopp√© par :</strong> BSCO Solutions</p>
                        <p><strong>License :</strong> MIT (Open-Source)</p>
                        <p>
                            <a href="https://github.com/csigno1204/BSCO-Dashboard-PowerBI" target="_blank">
                                üì¶ Code source sur GitHub
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts -->
        <div class="alert alert-success" id="successAlert" style="display: none;">
            <strong>‚úÖ Succ√®s !</strong>
            <p id="successMessage"></p>
        </div>

        <div class="alert alert-error" id="errorAlert" style="display: none;">
            <strong>‚ùå Erreur</strong>
            <p id="errorMessage"></p>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
